# 自动化翻译功能的实现

今天因为女朋友的公司需要翻译一大堆的英文文档，很多字的文档，用人工翻译，一点点复制到 google 翻译里都是需要很多时间的，看着自己亲爱的女朋友努力勤劳的一段段的通过复制粘贴进行文档翻译工作，实在是心疼，所以突发奇想，做一个自动化翻译工具可好？说做就做。

## 试错中

上来就打开了 chrome 浏览器的开发者工具，仔细观察查找是哪个接口实现的翻译, 就发现了他

> Request URL: https://translate.google.cn/translate_a/single?client=webapp&sl=zh-CN&tl=en&hl=zh-CN&dt=at&dt=bd&dt=ex&dt=ld&dt=md&dt=qca&dt=rw&dt=rm&dt=ss&dt=t&otf=1&ssel=0&tsel=0&kc=1&tk=561254.932049&q=%E4%B8%AD%E5%9B%BD%E4%BA%BA
> Request Method: GET

那我上来就用自己熟悉的 axios 开始调用吧。结果可想而知，跨域。
么得办法，反向代理？做啥子代理嘛，直接上 node 走你……

## 找方法

通过 node 的 express 脚手架，很轻松的就启动了一个服务，继续安装我喜欢的 axios，继续这个请求，发现成功了，开心，感觉分分钟解决这个事情。结果令我很是失望，稍微改变这里的一个参数返回结果就发生了错误。于是乎只能再另寻方案，通过某度搜索引擎，顺利发现了几个分享免费翻译的 api，如获至宝，将地址果断收藏起来。

> google: http://translate.google.cn/translate_a/single?client=gtx&dt=t&dj=1&ie=UTF-8&sl=auto&tl=zh_TW&q=calculate

> Bing: http://api.microsofttranslator.com/v2/Http.svc/Translate?appId=AFC76A66CF4F434ED080D245C30CF1E71C22959C&from=&to=en&text=考勤计算

> Baidu: http://fanyi.baidu.com/transapi?from=auto&to=cht&query=Calculation

> Youdao: http://fanyi.youdao.com/translate?&doctype=json&type=AUTO&i=计算

哇，试了一下 google, 啊，真好用啊，果断写了一系列方法准备开始翻译

## 实现方法

初次想法

1. 读简单整理后的 txt 文件
2. 通过\r\n 来将文章分成数组，每换一行就通过 await 方法翻译一下，放到新的数组中去
3. 将最终翻译完成的数组拼成文件，生成在本地

想法很好，在调试的过程中，手残直接执行了翻译，翻译到了一半就抛了个异常出来，发现了个 code 是 429 的错误，一查发现大量请求，再用它来翻译一下简单的单词，结果仍然 429. 凉凉了，没法再用谷歌翻译了。

加强版本

1.  读再次整理后的 txt 文件（为了防止太多语句要翻译，故将其通过自然段采用两个回车的形式分隔成几大段）
2.  通过判断\r\n\r\n 来分隔成数组，进行段落翻译，这样一篇文章就只用请求 10 次左右算是降低了请求次数
3.  将最终翻译完成的数组拼成文件，生成在本地

通过测试，发现还是有道专业搞翻译啊，api 就是好用，而且传参简洁，还支持批量查询，真实良心商家，默默点赞。哇好像这种方法是 ok 的，顺利的翻译出了第一篇文章。继续第二篇，结果突然在某次请求的时候抛出了新的异常，发现错误说明是文本中含有非法字符。我的天，那么长的文章我要何时才能找到错误在哪一段落呢？为了增加排错标记，将异常的请求的参数打印出来。这回真舒坦，有错一下子就能快速定位到了错误位置。通过再次整理 txt 文件，发现顺利解决了。完成了翻译，到此基本上大功告成。其实在整理文档发现通过换行很不合理，那么完全可以通过特殊字符来分隔段落，我这种方法不算太好，但是也简单的实现了需求。

## 总结

说实话这次有点赶进度，为了完成而完成。首先对于 txt 文档的整理完全可以采用自动化的方式实现自动分段，自动切割。然后就是翻译，没啥好说的，就是要同步的调用翻译接口，但是这里本来设计的是翻译一段话就写文件，但是考虑这样其实消耗挺多性能的，如果调 20 次的话，那么就有 20 次的 io 操作，所以考虑到文章并不长也就万字以内，那么通过变量去存这个文档还是扛得住的。但是如果文档更大一些，这就么得办法了，我也想了，可能采用流的方式对文章切割，然后仍然可以采用边读边写的方法，实现这个方案。
本次方案的解决发现了自己的不足的地方，对 node api 的操作能力还是很差劲的，还需要再回顾回顾。对于后端的思想以及解决方案的形成还有待提高。同样也是有收获，觉得以后完全可以自己做一些后端接口，简单操作一下文件啥的。么得问题的~

学无止境~想要拥有高层次的思维方式，还得先掌握本领。共勉~
